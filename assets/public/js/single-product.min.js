var reservingProductCorePrice = 0;
var price_element = jQuery(
  ".reserving-single-page .reserving_product_price .woocommerce-Price-amount"
);
if (price_element.length) {
  reservingProductCorePrice = price_element
    .prop("outerText")
    .replace(/[^a-z0-9áéíóúñü \.,_-]/gim, "");
}

function reservingUpdateSingleProductPrice() {
  let items = jQuery(
    ".reserving-single-page .reserving_extra_items input[type='checkbox']"
  );

  let extra_price = 0;
  let total_price = 0;

  jQuery.each(items, function (index, item) {
    if (jQuery(item).is(":checked")) {
      let extra_quantity = parseFloat(
        jQuery(item).closest("li").find(".extra_quantity").val()
      );

      if (
        extra_quantity == "" ||
        isNaN(extra_quantity) ||
        extra_quantity <= 0
      ) {
        extra_quantity = 1;
      }

      extra_price +=
        parseFloat(jQuery(item).val()) * parseFloat(extra_quantity);
    }
  });

  total_price = (parseFloat(reservingProductCorePrice) + extra_price).toFixed(
    2
  );

  jQuery(
    ".reserving-single-page .reserving_product_price .woocommerce-Price-amount"
  ).html(
    '<span class="woocommerce-Price-currencySymbol">' +
      ReservingData.currency_symbol +
      "</span>" +
      total_price
  );
}

jQuery(
  ".reserving-single-page .reserving_extra_items input[type='checkbox']"
).on("click", function () {
  reservingUpdateSingleProductPrice();
});

jQuery(".reserving-single-page .reserving_extra_items .extra_quantity").on(
  "change",
  reservingUpdateSingleProductPrice
);

jQuery(".reserving-single-page .reserving_extra_items .extra_quantity").on(
  "click",
  reservingUpdateSingleProductPrice
);

jQuery(".reserving-single-page .reserving_extra_items .extra_quantity").on(
  "keyup",
  reservingUpdateSingleProductPrice
);

jQuery(
  '.reserving-single-page ul.reserving_extra_items li label input[type="checkbox"]'
).on("change", reservingUpdateSingleProductPrice);

jQuery(document).on("added_to_cart", function (e, data) {
  data = {
    action: "reserving_cart_cookie_update",
  };

  jQuery.get(reserving_update_cart_vars.ajaxurl, data, function (response) {
    jQuery(document.body).trigger("update_checkout");
  });
});
