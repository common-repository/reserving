let quantities = {};
function reserving_validate_tip_amount() {
  var tips_button_add = document.querySelector(
      ".reserving--tip--action .reserving_extra_tip"
    ),
    tips_button_remove = document.querySelector(
      ".reserving--tip--action .reserving--cart--remove--extra-tip"
    ),
    input = document.querySelector(
      ".reserving--tip-fixed-input--wrapper input"
    ),
    cart_tip_amount;
  tips_button_add &&
    (Number(input.value) > 0
      ? ((tips_button_add.disabled = !1), (tips_button_remove.disabled = !1))
      : ((tips_button_add.disabled = !0), (tips_button_remove.disabled = !0)));
}
function reserving_cart_tip_input_clear() {
  var input = document.querySelector(
    ".reserving--tip-fixed-input--wrapper input"
  );
  (input.value = ""), input.focus();
}
function reserving_checkout_tip_store(event) {
  var cart_tip_amount = Number(
      document.querySelector(".reserving--tip-fixed-input--wrapper input").value
    ),
    cart_tip_type = document.querySelector(
      ".reserving--tip--type select"
    ).value,
    update_cart = document.querySelector(
      ".actions button[name*='update_cart']"
    );
  if (!(cart_tip_amount < 0)) {
    var data = {
      action: "reserving_cart_tip_update",
      reserving_cart_tip_type: cart_tip_type,
      reserving_cart_tip_amount: cart_tip_amount,
    };
    jQuery.get(reserving_update_cart_vars.ajaxurl, data, function (response) {
      jQuery(document.body).trigger("update_checkout"),
        update_cart && ((update_cart.disabled = !1), update_cart.click());
    });
  }
}
function reserving_update_side_cart(event_type = "") {
  var data = { action: "reserving_cart_latest_content" };
  jQuery.get(reserving_update_cart_vars.ajaxurl, data, function (response) {
    var data = null,
      $html_cart_item = jQuery(
        ".element-ready-shopping_cart-list-items ul"
      ).html("");
    response.success &&
      ((data = response.data.line_items),
      jQuery(".element-ready-wc-shopping-total-amount").text(
        response.data.subtotal
      ),
      jQuery.each(data, function (index, item) {
        var item_html = `\n           <li data-key="${index}">\n              <div class="element-ready-single-shopping-cart media">\n                     <div class="cart-image element-ready-cart-image">\n                          <img src="${item.image_url}" alt="${item.name}">\n                      </div>\n                  <div class="cart-content media-body pl-15">\n\n                      <h6>\n                        <a href="${item.link}">${item.name}</a>\n                      </h6>\n                      <span class="quality"> QTY:${item.quantity}</span>\n                    \n                      ${item.subtotal}\n                      <a data-product="${index}" class="element-ready-cart-item-remove" href="javascript:void(0);">\n                          <i class="fa fa-times"></i>\n                      </a>\n                  </div>\n              </div> \x3c!-- single shopping cart --\x3e\n          </li>\n       `;
        $html_cart_item.append(item_html);
      }));
  });
}
jQuery(document).on(
  "input",
  ".woocommerce-cart-form .extra_quantity",
  function () {
    let cart_ids;
    jQuery(".woocommerce-cart-form .reserving_extra_items")
      .map(function () {
        return jQuery(this).data("cart-id");
      })
      .get()
      .forEach(function (cart_id) {
        let item_quanitites = jQuery(
          ".woocommerce-cart-form .reserving_extra_items[data-cart-id='" +
            cart_id +
            "'] .extra_quantity"
        );
        (quantities[cart_id] = []),
          jQuery(item_quanitites).each(function () {
            quantities[cart_id].push(jQuery(this).val());
          });
      }),
      (document.cookie =
        "reserving_extra_quantities=" + JSON.stringify(quantities));
  }
),
  jQuery(document).on("updated_cart_totals", function (e) {
    reserving_update_side_cart("updated_cart_totals");
  }),
  jQuery(document).on("wc_fragments_refreshed", function (e, data) {}),
  jQuery(document).on("wc_cart_emptied", function (e) {
    jQuery(".element-ready-shopping_cart-list-items").html(""),
      jQuery(".element-ready-sub-total-amount").html(""),
      jQuery(".element-ready-interface-cart-count").text(0);
  }),
  document.addEventListener(
    "DOMContentLoaded",
    function () {
      if (jQuery("#reserving_thankyou_audio").length) {
        var audio_src = jQuery("#reserving_thankyou_audio").attr("src"),
          reserving_audio = new Audio(audio_src);
        void 0 !== reserving_audio.play && reserving_audio.play();
      }
      jQuery(document).on(
        "input",
        ".reserving--tip-fixed-input--wrapper input",
        function (e) {
          reserving_validate_tip_amount();
        }
      ),
        jQuery(document).on(
          "change",
          ".reserving--tip--type .reserving--cart--tip--type",
          function (e) {
            reserving_cart_tip_input_clear();
          }
        ),
        jQuery(document).on(
          "click",
          ".reserving--tip--action .reserving_extra_tip",
          function (e) {
            e.preventDefault(),
              reserving_checkout_tip_store(e),
              reserving_cart_tip_input_clear();
          }
        ),
        jQuery(document).on(
          "click",
          ".reserving--tip--action .reserving--cart--remove--extra-tip",
          function (e) {
            e.preventDefault(), reserving_cart_tip_input_clear();
            var data = {
              action: "reserving_cart_tip_remove",
              reserving_cart_tip_amount: 0,
            };
            jQuery.get(
              reserving_update_cart_vars.ajaxurl,
              data,
              function (response) {
                jQuery(document.body).trigger("update_checkout");
                var update_cart = document.querySelector(
                  ".actions button[name*='update_cart']"
                );
                update_cart &&
                  ((update_cart.disabled = !1), update_cart.click());
              }
            );
          }
        );
    },
    !1
  );
